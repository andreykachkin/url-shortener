
angular.module('app',['ngRoute']);angular.module('app').controller('AuthController',AuthController);AuthController.$inject=['$scope','$http','$location','$route'];function AuthController($scope,$http,$location,$route){$scope.checkAuth=function(){var data={username:$scope.username,password:$scope.password};$http.post('/authentication',data).success(function(){$route.reload();$location.path('/template/personal_info');}).error(function(){var authError=angular.element(document.querySelector('#error'));var error=angular.element('<p class="text-danger">Неправильный логин или пароль</p>');if(!authError.find('p')){authError.append(error);}else{authError.find('p').remove();authError.append(error);}});};}
angular.module('app').controller('RegController',RegController);RegController.$inject=['$scope','$http','$location','$route'];function RegController($scope,$http,$location,$route){$scope.reg=function(){var data={username:$scope.username,password:$scope.password};$http.post('/registration',data).success(function(){$route.reload();$location.path('/template/personal_info');}).error(function(){var regError=angular.element(document.querySelector('#error'));var error=angular.element('<p class="text-danger">Пользователь с таким именем уже существует.</p>');if(!regError.find('p')){regError.append(error);}else{regError.find('p').remove();regError.append(error);}});};}
angular.module('app').config(config);config.$inject=['$routeProvider','$locationProvider'];function config($routeProvider,$locationProvider){$routeProvider.when('/',{templateUrl:'/template/home',controller:'UrlsListController'}).when('/template/personal_info',{templateUrl:'/template/personal_info',controller:'UrlAuthListController'}).when('/template/login',{templateUrl:'/template/login',controller:'AuthController'}).when('/template/registration',{templateUrl:'/template/registration',controller:'RegController'}).when('/url/:url_id',{templateUrl:'/template/url_detail',controller:'UrlDetailController'}).when('/tags/:tag_id',{templateUrl:'/template/tags',controller:'TagListController'}).otherwise({redirectTo:'/'});$locationProvider.html5Mode(true);}
angular.module('app').controller('TagListController',TagListController);TagListController.$inject=['$scope','$http','$routeParams'];function TagListController($scope,$http,$routeParams){$scope.tag_id=$routeParams.tag_id;$http.get('/urls').success(function(data){$scope.urls=data;}).error(function(){});}
angular.module('app').controller('UrlAuthListController',UrlAuthListController);UrlAuthListController.$inject=['$scope','$http','$route'];function UrlAuthListController($scope,$http,$route){$http.get('/urlsAuth').success(function(data){$scope.sortParam='-_id';$scope.urls=data;$scope.totalAuthCounter=function(){var authorCounter=0;for(i=0;i<$scope.urls.length;i++){authorCounter+=$scope.urls[i].counter;}
return authorCounter;};$scope.tagsArr=function(tags){return tags.join(' ');};}).error(function(){});$scope.createUrl=function(){var data={url_long:$scope.url_long,description:$scope.description,tags:$scope.tags};$http.post('/createUrl',data).success(function(){$route.reload();}).error(function(){})};}
angular.module('app').controller('UrlDetailController',UrlDetailController);UrlDetailController.$inject=['$scope','$http','$routeParams','$route'];function UrlDetailController($scope,$http,$routeParams,$route){$scope.url_id=$routeParams.url_id;var url='/url/'+$routeParams.url_id;$http.get(url).success(function(data){$scope.url=data;});$scope.updateUrl=function(){var data={_id:$scope.url_id,description:$scope.description,tags:$scope.tags};$http.post('/updateUrl',data).success(function(){$route.reload();}).error(function(){})};}
angular.module('app').controller('UrlsListController',UrlsListController);UrlsListController.$inject=['$scope','$http'];function UrlsListController($scope,$http){$http.get('/urls').success(function(data){$scope.sortParam='-_id';$scope.urls=data;}).error(function(){});}